
do
(
	def(":ipow" "#a" "#b" function(
		set_copy(".i" 0)
		set_copy(".res" 1)
		while(less(get(".i") get("#b")) do(
			set_copy(".res" mult(get(".res") get("#a")))
			set_copy(".i" add(get(".i") 1))
		))
		return_copy(get(".res"))
	))
	
	print(get(":ipow" 2 8) "\n")
	
	def(":obj" "#name" "#age" function(
		set_copy(".obj" map)
		def(":print" "#thing" function(
			print(get("#thing"))
		))
		push_copy(get(".obj") 
			"name" get("#name")
			"age" get("#age")
			"say_hello" lambda(print("hello there!\n"))
			"echo" lambda("#msg" function(
				print(get("#msg"))
			))
			"print" ref_func(":print")
		)
		return_ref(get(".obj"))
	))
	
	set_ref("obj" get(":obj" "Greg" 21))
	print(get("obj") "\n")
	
	// $1.$2()
	#macro ([a-z_]+)\.([a-z_]+)\(\) eval(get_elem(get("$1")"$2"))
	
	// $1.$2($3)
	#macro ([a-z_]+)\.([a-z_]+)\((.+)\) eval(get_elem(get("$1")"$2")$3)
	
	obj.say_hello()
	obj.echo("this is echo!\n")
	obj.print("this is printed!\n")
)